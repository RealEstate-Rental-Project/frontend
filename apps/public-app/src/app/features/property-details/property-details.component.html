<div class="property-details-page" *ngIf="property">
  <!-- Gallery Section -->
  <div class="gallery-container">
    <div class="main-image">
      <img [src]="mainImage" alt="Main Property Image" />
    </div>
    <div class="sub-images">
      <div *ngFor="let img of galleryImages" class="sub-image">
        <img [src]="img" alt="Property Image" />
      </div>
      <button class="btn-view-all" (click)="toggleGallery()">
        View All Photos
      </button>
    </div>
  </div>

  <!-- Gallery Modal -->
  <div class="gallery-modal" *ngIf="showGallery">
    <div class="modal-header">
      <button class="btn-close" (click)="toggleGallery()">×</button>
    </div>
    <div class="modal-content">
      <div class="gallery-grid">
        <div *ngFor="let img of allImages" class="gallery-item">
          <img [src]="img" alt="Property Image" />
        </div>
      </div>
    </div>
  </div>

  <div class="container content-layout">
    <!-- Left Column: Details -->
    <div class="details-column">
      <div class="header-info">
        <h1>{{ property.title }}</h1>
        <div class="meta">
          <span class="rating">★ {{ property.rating }} ({{ property.nombreEtoiles }} Stars)</span>
          <span class="location">{{ property.city }}, {{ property.country }}</span>
        </div>
      </div>

      <div class="host-info">
        <div class="avatar-placeholder"></div>
        <div class="host-details">
          <span class="label">Hosted by</span>
          <span class="address">{{ property.ownerEthAddress | slice : 0 : 6 }}...{{
            property.ownerEthAddress | slice : -4
            }}</span>
        </div>
      </div>

      <div class="description">
        <h3>About this place</h3>
        <p>{{ property.description }}</p>
      </div>

      <div class="rooms-section">
        <h3>Rooms & Spaces</h3>
        <div class="rooms-list">
          <div *ngFor="let room of property.rooms" class="room-item">
            <h4>{{ room.name }}</h4>
            <div class="room-photos">
              <img *ngFor="let img of room.roomImages" [src]="img.url" alt="{{ room.name }}" />
            </div>
          </div>
        </div>
      </div>

      <div class="map-section">
        <h3>Location</h3>
        <div id="map"></div>
      </div>
    </div>

    <!-- Right Column: Sticky Sidebar -->
    <div class="sidebar-column">
      <div class="booking-card">
        <div class="card-header">
          <div class="price">
            <span class="amount">{{
              property.rentAmount | currency : 'USD' : 'symbol' : '1.0-0'
              }}</span>
            <span class="period">/ month</span>
          </div>
          <div class="status" [class.available]="property.isAvailable">
            {{ property.isAvailable ? 'Available' : 'Rented' }}
          </div>
        </div>

        <div class="costs-breakdown">
          <div class="cost-row">
            <span>Security Deposit</span>
            <span>{{
              property.securityDeposit | currency : 'USD' : 'symbol' : '1.0-0'
              }}</span>
          </div>
          <div class="cost-row total">
            <span>Total to Pay</span>
            <span>{{
              property.rentAmount + property.securityDeposit
              | currency : 'USD' : 'symbol' : '1.0-0'
              }}</span>
          </div>
        </div>

        <button class="btn-rent" (click)="toggleReservation()" [disabled]="isOwner">
          Rent Now (ETH)
        </button>
      </div>

      <!-- AI Price Prediction Card -->
      <div class="ai-prediction-card" *ngIf="property.predictedPrice">
        <div class="ai-header">
          <div class="ai-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 2v8"></path>
              <path d="m4.93 10.93 1.41 1.41"></path>
              <path d="M2 18h2"></path>
              <path d="M20 18h2"></path>
              <path d="m19.07 10.93-1.41 1.41"></path>
              <path d="M22 22H2"></path>
              <path d="m8 22 4-10 4 10"></path>
            </svg>
          </div>
          <div class="ai-title">
            <h4>AI Price Suggestion</h4>
            <span class="ai-badge">Premium Insight</span>
          </div>
        </div>
        <div class="prediction-info">
          <div class="predicted-amount">
            <span class="eth-value">{{ property.predictedPrice.price_eth | number:'1.4-4' }} ETH</span>
            <span class="label">Market Value Prediction</span>
          </div>
          <p class="prediction-note">
            Our AI analyzed local trends and property specs to calculate this recommendation.
          </p>
          <div class="comparison"
            [class.overpriced]="property.predictedPrice.price_eth < property.predictedPrice.price_eth"
            [class.underpriced]="property.predictedPrice.price_eth > property.predictedPrice.price_eth">
            <div class="comparison-bar">
              <div class="bar-fill" [style.width]="'100%'"></div>
            </div>
            <span class="comparison-text">Fair market value for this neighborhood</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Reservation Request Modal -->
  <app-reservation-request *ngIf="showReservation" [property]="property" [isOwner]="isOwner"
    (close)="toggleReservation()">
  </app-reservation-request>
</div>