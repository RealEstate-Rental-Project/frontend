<div class="profile-page" *ngIf="!loading && user">
    <!-- Header -->
    <div class="profile-header">
        <div class="header-content container">
            <div class="user-section">
                <div class="avatar-wrapper">
                    <img [src]="avatarUrl" alt="Profile Picture" class="avatar">
                    <div class="verified-badge" title="Verified User">
                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                    </div>
                </div>
                <div class="user-info">
                    <h1>{{ user.firstName }} {{ user.lastName }}</h1>
                    <p class="username">@{{ user.username }}</p>
                    <p class="wallet-address">{{ user.wallet | slice:0:6 }}...{{ user.wallet | slice:-4 }}</p>
                </div>
            </div>

            <!-- Header Actions -->
            <div class="header-actions">
                <a class="action-btn" routerLink="/properties/my-listings">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                    <span>My Properties</span>
                </a>
                <a class="action-btn" routerLink="/my-reservations">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    <span>My Reservations</span>
                </a>
                <div class="wallet-badge">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                        <line x1="1" y1="10" x2="23" y2="10"></line>
                    </svg>
                    <span>{{ user.wallet | slice:0:6 }}...{{ user.wallet | slice:-4 }}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Grid -->
    <div class="profile-content container">

        <!-- Personal Info (Left Column) -->
        <div class="card info-card">
            <div class="card-header">
                <h2>Personal Information</h2>
                <button class="btn-icon" title="Edit Profile" (click)="toggleEditProfile()">
                    <svg *ngIf="!isEditingProfile" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                    <svg *ngIf="isEditingProfile" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" 
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>

            <form class="profile-form" (ngSubmit)="saveProfile()">
                <div class="form-row">
                    <div class="form-group half">
                        <label>First Name</label>
                        <input type="text" [(ngModel)]="user.firstName" name="firstName" [readonly]="!isEditingProfile">
                    </div>
                    <div class="form-group half">
                        <label>Last Name</label>
                        <input type="text" [(ngModel)]="user.lastName" name="lastName" [readonly]="!isEditingProfile">
                    </div>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" [(ngModel)]="user.email" name="email" [readonly]="!isEditingProfile">
                </div>
                <div class="form-group">
                    <label>Bio</label>
                    <textarea [(ngModel)]="user.description" name="description" rows="3" [readonly]="!isEditingProfile"></textarea>
                </div>
                
                <div class="form-actions" *ngIf="isEditingProfile">
                    <button type="submit" class="btn-save" [disabled]="isSavingProfile">
                        {{ isSavingProfile ? 'Saving...' : 'Save Changes' }}
                    </button>
                    <p *ngIf="profileSaveMessage" [class.success]="profileSaveMessage.includes('successfully')"
                        [class.error]="!profileSaveMessage.includes('successfully')" class="status-message">
                        {{ profileSaveMessage }}
                    </p>
                </div>
            </form>
        </div>

        <!-- AI Preferences (Right Column) -->
        <div class="card info-card">
            <div class="card-header">
                <h2>AI Recommendation Preferences</h2>
            </div>
            <p class="info-text">
                Help our AI find the perfect property for you by setting your preferences.
            </p>

            <form class="profile-form" (ngSubmit)="savePreferences()">
                <div class="form-row">
                    <div class="form-group half">
                        <label>Target Rent ($)</label>
                        <input type="number" [(ngModel)]="user.targetRent" name="targetRent" placeholder="e.g. 1500">
                    </div>
                    <div class="form-group half">
                        <label>Min Rooms</label>
                        <input type="number" [(ngModel)]="user.minTotalRooms" name="minTotalRooms" placeholder="e.g. 2">
                    </div>
                </div>
                <div class="form-group">
                    <label>Target Area (sq ft)</label>
                    <input type="number" [(ngModel)]="user.targetSqft" name="targetSqft" placeholder="e.g. 800">
                </div>
                <div class="form-row">
                    <div class="form-group half">
                        <label>Property Type</label>
                        <div class="select-wrapper">
                            <select [(ngModel)]="user.preferredPropertyType" name="preferredPropertyType">
                                <option [ngValue]="null">Any Type</option>
                                <option *ngFor="let type of propertyTypes" [value]="type">{{ type }}</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group half">
                        <label>Rental Type</label>
                        <div class="select-wrapper">
                            <select [(ngModel)]="user.preferredRentalType" name="preferredRentalType">
                                <option [ngValue]="null">Any Duration</option>
                                <option *ngFor="let type of rentalTypes" [value]="type">{{ type }}</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn-save" [disabled]="isSaving">
                        {{ isSaving ? 'Saving...' : 'Save Preferences' }}
                    </button>
                    <p *ngIf="saveMessage" [class.success]="saveMessage.includes('successfully')"
                        [class.error]="!saveMessage.includes('successfully')" class="status-message">
                        {{ saveMessage }}
                    </p>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="loading-screen" *ngIf="loading">
    <div class="spinner"></div>
</div>