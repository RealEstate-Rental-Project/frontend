<div class="contracts-page">
    <div class="container">

        <!-- Header -->
        <div class="page-header">
            <h1>My Contracts</h1>
            <p class="subtitle">Manage your active rental agreements and confirm key deliveries.</p>
        </div>

        <!-- Loading State -->
        <div *ngIf="loading" class="state-container">
            <div class="spinner"></div>
            <p>Loading your contracts...</p>
        </div>

        <!-- Empty State -->
        <div *ngIf="!loading && contracts.length === 0" class="state-container empty">
            <div class="empty-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="16" y1="13" x2="8" y2="13"></line>
                    <line x1="16" y1="17" x2="8" y2="17"></line>
                    <polyline points="10 9 9 9 8 9"></polyline>
                </svg>
            </div>
            <h3>No Active Contracts</h3>
            <p>You don't have any active rental contracts yet.</p>
            <a routerLink="/properties" class="btn-primary">Browse Properties</a>
        </div>

        <!-- Contracts Grid -->
        <div *ngIf="!loading && contracts.length > 0" class="contracts-grid">
            <div class="contract-card" *ngFor="let contract of contracts">

                <!-- Status Badge -->
                <div class="card-status">
                    <span class="badge" [ngClass]="getStatusClass(contract.state)">
                        {{ contract.state?.replace('_', ' ') || 'UNKNOWN' }}
                    </span>
                </div>

                <div class="card-content">
                    <div class="contract-header">
                        <span class="contract-id">Contract #{{ contract.idContract }}</span>
                        <h2 class="property-title">{{ contract.property?.title || 'Unknown Property' }}
                        </h2>
                        <p class="address">{{ contract.property?.address }}</p>
                    </div>

                    <div class="contract-details">
                        <div class="info-item">
                            <span class="label">Start Date</span>
                            <span class="value">{{ contract.startDate | date:'mediumDate' }}</span>
                        </div>
                        <div class="info-item">
                            <span class="label">End Date</span>
                            <span class="value">{{ contract.endDate | date:'mediumDate' }}</span>
                        </div>
                        <div class="info-item price">
                            <span class="label">Total Amount</span>
                            <span class="value">{{ contract.TotalAmountToPay }} ETH</span>
                        </div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="card-footer">
                    <!-- Key Delivery Action -->
                    <div *ngIf="contract.state === 'PENDING_RESERVATION' && !contract.isKeyDelivered"
                        class="action-area">
                        <div class="info-box">
                            <i class="fas fa-key"></i>
                            <span>Keys received? Confirm to activate contract.</span>
                        </div>
                        <button (click)="confirmKeyDelivery(contract)" [disabled]="processingId === contract.idContract"
                            class="btn-action btn-activate">

                            <span *ngIf="processingId !== contract.idContract">
                                Confirm Key Delivery
                            </span>

                            <div *ngIf="processingId === contract.idContract" class="processing-state">
                                <div class="spinner-small"></div>
                                <span>Processing...</span>
                            </div>
                        </button>
                    </div>

                    <!-- Active State -->
                    <div *ngIf="contract.state === 'ACTIVE'" class="active-status">
                        <i class="fas fa-check-circle"></i>
                        <span>Contract Active</span>
                    </div>
                </div>

            </div>
        </div>

    </div>
</div>