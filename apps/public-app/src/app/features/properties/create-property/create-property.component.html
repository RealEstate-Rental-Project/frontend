<div class="create-property-page">
  <div class="container">
    <!-- Header -->
    <div class="wizard-header">
      <h1>{{ isEditMode ? 'Edit Property' : 'Create New Property' }}</h1>
      <div class="progress-bar">
        <div class="step" [class.active]="currentStep >= 1" [class.completed]="currentStep > 1">
          1. Basic Info
        </div>
        <div class="line" [class.filled]="currentStep > 1"></div>
        <div class="step" [class.active]="currentStep >= 2" [class.completed]="currentStep > 2">
          2. Location
        </div>
        <div class="line" [class.filled]="currentStep > 2"></div>
        <div class="step" [class.active]="currentStep >= 3" [class.completed]="currentStep > 3">
          3. Details & Rooms
        </div>
        <div class="line" [class.filled]="currentStep > 3"></div>
        <div class="step" [class.active]="currentStep >= 4">4. Review</div>
      </div>
    </div>

    <!-- Step 1: Basic Info -->
    <div class="wizard-step" *ngIf="currentStep === 1">
      <h2>Basic Information</h2>
      <div class="form-group">
        <label>Property Title</label>
        <input type="text" [(ngModel)]="property.title" placeholder="e.g. Luxury Villa in Marrakech" />
      </div>
      <div class="form-group">
        <label>Description</label>
        <textarea [(ngModel)]="property.description" rows="5" placeholder="Describe your property..."></textarea>
      </div>
      <div class="form-group">
        <label>Type of Rental</label>
        <select [(ngModel)]="property.typeOfRental">
          <option *ngFor="let type of rentalTypes" [value]="type">
            {{ type }}
          </option>
        </select>
      </div>
    </div>

    <!-- Step 2: Location -->
    <div class="wizard-step" *ngIf="currentStep === 2">
      <h2>Location</h2>
      <div class="form-group">
        <label>Country</label>
        <input type="text" [(ngModel)]="property.country" placeholder="e.g. Morocco" />
      </div>
      <div class="form-group">
        <label>City</label>
        <input type="text" [(ngModel)]="property.city" placeholder="e.g. Marrakech" />
      </div>
      <div class="form-group">
        <label>Address</label>
        <input type="text" [(ngModel)]="property.address" placeholder="Full address" />
      </div>
    </div>

    <!-- Step 3: Details & Rooms -->
    <div class="wizard-step" *ngIf="currentStep === 3">
      <h2>Financials</h2>
      <div class="form-row">
        <div class="form-group">
          <label>Rent per Month (ETH)</label>
          <input type="number" [(ngModel)]="property.rentPerMonth" />
        </div>
        <div class="form-group">
          <label>Security Deposit (ETH)</label>
          <input type="number" [(ngModel)]="property.securityDeposit" />
        </div>
      </div>

      <h2>Rooms</h2>
      <div class="rooms-list">
        <div class="room-item-container" *ngFor="let room of property.rooms; let i = index">
          <div class="room-item">
            <span class="room-name">{{ i + 1 }}. {{ room.name }}</span>
            <button class="btn-remove" (click)="removeRoom(i)">Ã—</button>
          </div>

          <div class="room-files">
            <input type="file" multiple (change)="onFileSelected($event, i)" accept="image/*" [id]="'file-' + i"
              class="file-input" />
            <label [for]="'file-' + i" class="btn-upload">
              ðŸ“· Add Photos
            </label>

            <div class="selected-files"
              *ngIf="(room.files && room.files.length > 0) || (room.existingImages && room.existingImages.length > 0)">
              <!-- Existing Images -->
              <div class="file-chip existing" *ngFor="let img of room.existingImages; let k = index">
                <img [src]="img.url" alt="Room Image" class="thumb" (click)="openPreview(img.url)">
                <button (click)="removeExistingImage(i, k)">Ã—</button>
              </div>

              <!-- New Files -->
              <div class="file-chip" *ngFor="let file of room.files; let j = index">
                <span>{{ file.name }}</span>
                <button (click)="removeFile(i, j)">Ã—</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="add-room-form">
        <input type="text" [(ngModel)]="newRoomName" placeholder="Room Name (e.g. Master Bedroom)" />
        <button class="btn-secondary" (click)="addRoom()">Add Room</button>
      </div>
    </div>

    <!-- Step 4: Review -->
    <div class="wizard-step" *ngIf="currentStep === 4">
      <h2>Review Property</h2>
      <div class="review-section">
        <div class="review-group">
          <h3>Basic Info</h3>
          <p>
            <strong>{{ property.title }}</strong>
          </p>
          <p>{{ property.description }}</p>
          <p>Type: {{ property.typeOfRental }}</p>
        </div>

        <div class="review-group">
          <h3>Location</h3>
          <p>
            {{ property.address }}, {{ property.city }}, {{ property.country }}
          </p>
        </div>

        <div class="review-group">
          <h3>Financials</h3>
          <div class="form-row">
            <p>
              Rent: <strong>{{ property.rentPerMonth }} ETH</strong>
            </p>
            <p>
              Deposit: <strong>{{ property.securityDeposit }} ETH</strong>
            </p>
          </div>
        </div>

        <div class="review-group">
          <h3>Rooms ({{ property.rooms.length }})</h3>
          <div class="review-rooms">
            <div class="review-room-item" *ngFor="let room of property.rooms; let i = index">
              <strong>{{ i + 1 }}. {{ room.name }}</strong>
              <span>{{ room.files?.length || 0 }} photos attached</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Navigation -->
    <div class="wizard-actions">
      <button class="btn-prev" (click)="prevStep()" [disabled]="currentStep === 1">
        Back
      </button>

      <button class="btn-next" (click)="nextStep()" *ngIf="currentStep < totalSteps">
        Next Step
      </button>
      <button class="btn-submit" (click)="submitProperty()" *ngIf="currentStep === totalSteps">
        {{ isEditMode ? 'Update Property' : 'Submit Property' }}
      </button>
    </div>
  </div>

  <!-- Image Preview Modal -->
  <div class="image-preview-modal" *ngIf="previewImage" (click)="closePreview()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <button class="btn-close" (click)="closePreview()">Ã—</button>
      <img [src]="previewImage" alt="Preview">
    </div>
  </div>
</div>