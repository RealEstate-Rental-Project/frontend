<div class="properties-page">
    <!-- Hero Section -->
    <app-hero title="Explore Our Properties" subtitle="Find the perfect place for your next stay or long-term home."
        (search)="onSearch($event)" (viewMap)="toggleView()">
    </app-hero>

    <div class="container main-content">
        <!-- Properties Grid -->
        <div class="properties-grid-wrapper">
            <div *ngIf="isLoading" class="loading-state">
                <div class="spinner"></div>
                <p>Loading properties...</p>
            </div>

            <div id="properties-map" [class.hidden]="!showMap"></div>

            <div *ngIf="!isLoading && !showMap && filteredProperties.length === 0" class="empty-state">
                <p>No properties found matching your criteria.</p>
                <button class="btn-reset" (click)="loadProperties()">Reset Filters</button>
            </div>

            <div *ngIf="!isLoading && !showMap && filteredProperties.length > 0" class="property-grid">
                <div *ngFor="let property of filteredProperties" class="property-card">
                    <div class="card-image">
                        <img [src]="property.rooms[0]?.roomImages?.[0]?.url || 'https://images.unsplash.com/photo-1541123356219-284ebe98ae3b?q=80&w=1000&auto=format&fit=crop'"
                            alt="{{ property.title }}">
                        <div class="badge" [class.available]="property.isAvailable">
                            {{ property.isAvailable ? 'Available' : 'Rented' }}
                        </div>
                        <!-- AI Prediction Badge -->
                        <div *ngIf="property.predictedPrice" class="ai-badge"
                            [title]="'AI recommended price for this area: ' + property.predictedPrice.price_eth + ' ETH'">
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M12 2v8"></path>
                                <path d="m4.93 10.93 1.41 1.41"></path>
                                <path d="M2 18h2"></path>
                                <path d="M20 18h2"></path>
                                <path d="m19.07 10.93-1.41 1.41"></path>
                                <path d="M22 22H2"></path>
                                <path d="m8 22 4-10 4 10"></path>
                            </svg>
                            <span>AI Value: <b>{{ property.predictedPrice.price_eth | number:'1.4-4' }} ETH</b></span>
                        </div>
                        <div class="price-tag">
                            {{ property.rentAmount | currency:'USD':'symbol':'1.0-0' }}<span>/mo</span>
                        </div>
                    </div>

                    <div class="card-content">
                        <div class="type">{{ property.typeOfRental === 'MONTHLY' ? 'Long Term' : 'Short Term' }}</div>
                        <h3>{{ property.title }}</h3>
                        <p class="location">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                <circle cx="12" cy="10" r="3"></circle>
                            </svg>
                            {{ property.city }}, {{ property.country }}
                        </p>
                        <p class="description">{{ property.description | slice:0:100 }}...</p>

                        <div class="card-footer">
                            <button class="btn-details" [routerLink]="['/properties', property.idProperty]">View
                                Details</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>